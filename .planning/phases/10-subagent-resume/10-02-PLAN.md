---
phase: 10-subagent-resume
plan: 02
type: execute
---

<objective>
Create /gsd:resume-task command and integrate agent resumption into existing GSD workflows.

Purpose: Enable users to resume interrupted subagent executions and provide visibility into resumable work.
Output: New resume-task command, workflow, and integration with resume-project and progress commands.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-subagent-resume/10-01-SUMMARY.md

**Depends on:**
- 10-01: Agent ID tracking foundation must be in place

**Key capability:**
Task tool accepts `resume` parameter with agent_id to continue from previous execution.
We need to expose this to users via /gsd:resume-task command.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create resume-task workflow</name>
  <files>get-shit-done/workflows/resume-task.md</files>
  <action>Create workflow for resuming interrupted subagent execution.

Process:
1. Parse optional agent_id argument (default: read from .planning/current-agent-id.txt)
2. Validate agent exists in agent-history.json with status "spawned" or "interrupted"
3. Check for file modifications since interruption (warn user of potential conflicts)
4. Spawn Task tool with resume parameter set to agent_id
5. On completion, update agent-history.json status to "completed"
6. Clear current-agent-id.txt

Error handling:
- If no agent_id provided and current-agent-id.txt empty → error "No active agent to resume"
- If agent_id not in history → error "Agent ID not found in history"
- If agent already completed → error "Agent already completed"

File conflict detection:
- Store file checksums in agent-history.json on spawn
- On resume, compare current checksums to stored
- If mismatch, warn: "Files modified since interruption: [list]. Continue anyway? (yes/no)"

Use AskUserQuestion for the conflict warning.</action>
  <verify>Workflow file exists with process, error handling, and conflict detection</verify>
  <done>resume-task workflow handles all resume scenarios with proper validation</done>
</task>

<task type="auto">
  <name>Task 2: Create resume-task command</name>
  <files>commands/gsd/resume-task.md</files>
  <action>Create slash command that delegates to resume-task workflow.

Follow GSD command pattern (see existing commands like execute-plan.md):
- Frontmatter with description, argument-hint, allowed-tools
- Objective explaining what the command does
- Execution context referencing the workflow
- Context loading STATE.md and agent-history.json
- Process delegating to workflow
- Success criteria

argument-hint: "[agent-id]" (optional - defaults to most recent)

Command should support:
- /gsd:resume-task - resume most recent interrupted agent
- /gsd:resume-task agent_abc123 - resume specific agent by ID</action>
  <verify>commands/gsd/resume-task.md exists and follows GSD command structure</verify>
  <done>resume-task command created with proper GSD structure</done>
</task>

<task type="auto">
  <name>Task 3: Integrate with resume-project workflow</name>
  <files>get-shit-done/workflows/resume-project.md</files>
  <action>Update resume-project.md to detect and surface resumable agents.

In check_incomplete_work step, add agent detection:
```bash
# Check for interrupted agents
if [ -f .planning/current-agent-id.txt ] && [ -s .planning/current-agent-id.txt ]; then
  AGENT_ID=$(cat .planning/current-agent-id.txt)
  echo "Interrupted agent: $AGENT_ID"
fi
```

In present_status step, add section:
```
[If interrupted agent found:]
⚠️  Interrupted agent detected:
    Agent ID: [id]
    Task: [task description from history]
    Interrupted: [timestamp]

    Resume with: /gsd:resume-task
```

In offer_options step, when interrupted agent exists:
- Make "Resume interrupted agent (/gsd:resume-task)" the primary action
- Secondary: "Start fresh (abandon agent)"

This ensures users see resumable work when they return to a project.</action>
  <verify>resume-project.md checks for interrupted agents and offers resume option</verify>
  <done>resume-project workflow surfaces resumable agents to users</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] get-shit-done/workflows/resume-task.md exists with full workflow
- [ ] commands/gsd/resume-task.md exists and follows GSD pattern
- [ ] resume-project.md detects interrupted agents
- [ ] resume-project.md offers resume option when agent found
</verification>

<success_criteria>
- All tasks completed
- /gsd:resume-task command functional
- Users see resumable agents when returning to projects
- File conflict detection warns about changes
</success_criteria>

<output>
After completion, create `.planning/phases/10-subagent-resume/10-02-SUMMARY.md`
</output>
