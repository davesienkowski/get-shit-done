---
phase: 10-subagent-resume
plan: 01
type: execute
---

<objective>
Implement agent ID tracking infrastructure so Task tool subagent IDs are captured and stored during /gsd:execute-plan execution.

Purpose: Foundation for resuming interrupted subagent executions - without tracking IDs, we can't resume.
Output: Modified execute-phase.md workflow that captures/stores agent IDs, plus storage templates.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md

**Source requirement:**
GitHub Issue #37: https://github.com/glittercowboy/get-shit-done/issues/37

**Key insight:**
Task tool returns agent_id in its response when spawning subagents. We need to:
1. Capture these IDs when execute-phase spawns subagents
2. Store current active ID for quick resumption
3. Maintain history for audit trail and conflict detection
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create agent-history.json template</name>
  <files>get-shit-done/templates/agent-history.md</files>
  <action>Create template documentation for .planning/agent-history.json with JSON schema.

Structure should track:
- entries array with: agent_id, task_description, phase, plan, timestamp, status (spawned/completed/interrupted/resumed)
- Each entry represents an agent spawn or status change
- Status transitions: spawned → completed OR spawned → interrupted → resumed → completed

Template should be a markdown file (matching GSD template pattern) documenting the JSON format with examples. Include guidance for:
- When entries are added (on Task tool spawn)
- When status updates (on completion or interruption detection)
- Maximum entries to retain (suggest 50 for audit without bloat)</action>
  <verify>File exists at get-shit-done/templates/agent-history.md, contains JSON schema documentation</verify>
  <done>Template created with clear schema for agent tracking</done>
</task>

<task type="auto">
  <name>Task 2: Add agent ID capture to execute-phase workflow</name>
  <files>get-shit-done/workflows/execute-phase.md</files>
  <action>Modify execute-phase.md to capture and store agent IDs when spawning subagents.

Add new step after parse_segments (before segment_execution):
```
<step name="init_agent_tracking">
Initialize agent tracking for this execution session:
1. Create/update .planning/current-agent-id.txt (will be overwritten on each spawn)
2. Read existing .planning/agent-history.json or create from template if missing
</step>
```

Modify segment_execution step - in the subagent spawn section, add:
```
After Task tool returns, capture agent_id from response.
Store to .planning/current-agent-id.txt (single line, just the ID)
Append to .planning/agent-history.json:
{
  "agent_id": "[captured id]",
  "task_description": "[tasks being executed]",
  "phase": "[phase number]",
  "plan": "[plan number]",
  "timestamp": "[ISO timestamp]",
  "status": "spawned"
}
```

Modify completion handling - after subagent completes successfully:
```
Update .planning/agent-history.json entry for this agent_id:
- Change status from "spawned" to "completed"
- Add completion_timestamp field
Clear .planning/current-agent-id.txt (empty file or delete)
```

IMPORTANT: Preserve all existing execute-phase functionality. This is additive tracking only.</action>
  <verify>execute-phase.md contains init_agent_tracking step and agent ID capture in segment_execution</verify>
  <done>Execute-phase workflow captures and stores agent IDs on spawn/completion</done>
</task>

<task type="auto">
  <name>Task 3: Add agent tracking to autonomous execution path</name>
  <files>get-shit-done/workflows/execute-phase.md</files>
  <action>Ensure fully autonomous plans (Pattern A - no checkpoints) also track agent IDs.

In parse_segments step where Pattern A spawns single subagent, add same tracking:
- Write agent_id to current-agent-id.txt after spawn
- Append to agent-history.json with status "spawned"
- On completion, update status to "completed" and clear current-agent-id.txt

This ensures ALL subagent spawns are tracked, not just segmented plans.

The tracking code should be consistent between Pattern A and Pattern B (segmented) paths.</action>
  <verify>Both autonomous and segmented execution paths include agent ID tracking</verify>
  <done>All subagent spawns in execute-phase are tracked consistently</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] get-shit-done/templates/agent-history.md exists with JSON schema
- [ ] execute-phase.md has init_agent_tracking step
- [ ] execute-phase.md captures agent_id in segment_execution (Pattern B)
- [ ] execute-phase.md captures agent_id in autonomous execution (Pattern A)
- [ ] Agent history includes status lifecycle (spawned → completed)
</verification>

<success_criteria>
- All tasks completed
- execute-phase.md modified to track agent IDs
- Template documents JSON storage format
- No breaking changes to existing execute-phase behavior
</success_criteria>

<output>
After completion, create `.planning/phases/10-subagent-resume/10-01-SUMMARY.md`
</output>
